<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MagicBlock Quiz — Leaderboard</title>
    <link rel="icon" href="../assets/faviconlogo/favicon.ico" />
    <link rel="stylesheet" href="../styles.css" />
    
    <style>
      .lb-wrap { max-width: 1200px; margin: 0 auto; padding: 34px 20px 90px; }
      .lb-title { font-size: clamp(42px, 5vw, 74px); font-weight: 900; letter-spacing: -0.04em; margin: 14px 0 8px; }
      .lb-sub { opacity: 0.82; margin: 0 0 22px; max-width: 70ch; }
      .lb-shell { border-radius: 28px; padding: 18px; }
      .lb-toolbar { display:flex; align-items:center; gap:12px; margin: 12px 0 18px; flex-wrap: wrap; }
      .lb-search { flex: 1 1 280px; }
      .lb-search input { width:100%; }
      .lb-meta { opacity: 0.8; font-size: 14px; }

      .lb-head { 
        display:grid;
        grid-template-columns: 56px minmax(230px, 1.25fr) minmax(220px, 1fr) minmax(220px, 1fr) 110px;
        gap: 12px;
        padding: 10px 12px;
        font-size: 12px;
        letter-spacing: .14em;
        text-transform: uppercase;
        opacity: .72;
        align-items: center;
        border-bottom: 1px solid rgba(255,255,255,.08);
        margin-bottom: 10px;
      }

      /* Keep numeric columns visually “under the ruler” */
      .lb-head > div:nth-child(3),
      .lb-head > div:nth-child(4),
      .lb-head > div:nth-child(5){ text-align:center; }

      .lb-list { display:flex; flex-direction:column; gap: 10px; }
      .lb-row {
        display:grid;
        grid-template-columns: 56px minmax(230px, 1.25fr) minmax(220px, 1fr) minmax(220px, 1fr) 110px;
        gap: 12px;
        align-items:center;
        padding: 12px;
        border-radius: 22px;
        border: 1px solid rgba(255,255,255,.10);
        background: rgba(255,255,255,.05);
      }
      .lb-row:hover{
        background: rgba(255,255,255,.07);
        border-color: rgba(255,255,255,.16);
      }
      .lb-rank { opacity: .85; font-weight: 800; }
      .lb-me { border-color: rgba(255,255,255,.28); background: rgba(255,255,255,.08); }

      .lb-user { display:flex; align-items:center; gap:12px; min-width: 0; }
      .lb-avatar { width: 44px; height: 44px; border-radius: 16px; object-fit: cover; background: rgba(255,255,255,.06); border: 1px solid rgba(255,255,255,.12); }
      .lb-nameWrap { min-width:0; }
      .lb-nick { display:flex; align-items:center; gap:8px; min-width:0; }
      .lb-nickText { font-weight: 900; letter-spacing: -0.01em; white-space: nowrap; overflow:hidden; text-overflow: ellipsis; min-width:0; }
      .lb-id { opacity:.65; font-size: 12px; white-space: nowrap; overflow:hidden; text-overflow: ellipsis; max-width: 18ch; }

      .lb-total { display:flex; justify-content:center; }
      .lb-chip { display:inline-flex; align-items:center; justify-content:center; gap:8px; padding: 7px 12px; border-radius: 999px; background: rgba(0,0,0,.22); border: 1px solid rgba(255,255,255,.10); font-size: 12px; font-weight: 800; line-height: 1; white-space: nowrap; }
      .lb-chip strong{ font-size: 13px; line-height: 1; }
      .lb-total .lb-chip{ min-width: 90px; }

      .lb-season { display:flex; align-items:center; justify-content:center; gap: 10px; min-width:0; }
      .lb-season .lb-chip{ min-width: 96px; }
      .lb-score { flex: 0 0 auto; }
      .lb-cardBadge{
        display:inline-flex;
        align-items:center;
        gap:8px;
        padding: 7px 12px;
        border-radius: 999px;
        border: 1px solid rgba(255,255,255,.14);
        background: rgba(255,255,255,.06);
        font-size: 12px;
        font-weight: 800;
        opacity: .92;
        white-space: nowrap;
      }
      .lb-cardBadge::before{
        content:"";
        width: 8px; height: 8px;
        border-radius: 999px;
        background: rgba(255,255,255,.85);
        box-shadow: 0 0 0 2px rgba(0,0,0,.25);
      }
      
      .lb-none { opacity:.70; font-size: 12px; border: 1px dashed rgba(255,255,255,.18); padding: 7px 12px; border-radius: 999px; }

      .lb-empty { opacity: .85; padding: 20px; }
      .lb-note { opacity: .7; font-size: 13px; margin-top: 14px; }

      @media (max-width: 980px){
        .lb-head, .lb-row{
          grid-template-columns: 48px minmax(200px, 1fr) minmax(220px, 1fr) 100px;
        }
        .lb-head .col-s2, .lb-row .col-s2{ display:none; }
      }
      @media (max-width: 680px){
        .lb-head{ display:none; }
        .lb-row{
          grid-template-columns: 1fr;
          gap: 10px;
        }
        .lb-rank{ display:none; }
        .lb-total{ justify-content:flex-start; }
        .lb-season{ justify-content:flex-start; }
        .lb-row .col-s2{ display:flex; }
      }
    </style>

  <link rel="stylesheet" href="../assets/topbar.css" />
  <script src="../assets/js/topbar.js" defer></script>

</head>
  <body data-require-profile="1">
    <!-- Background -->
    <div class="bg">
      <video class="bg__video" autoplay muted loop playsinline preload="auto">
        <source src="https://cdn.prod.website-files.com/67dd3f471f62a240dd544dd8%2F67dd41b5485dd4cf31eee3c0_Home_Beams-transcode.mp4" type="video/mp4" />
      </video>
      <div class="bg__vignette"></div>
      <div class="bg__grain"></div>
    </div>

    <main class="lb-wrap">
      <h1 class="lb-title">Leaderboard</h1>
      <p class="lb-sub">Public ranking by total score (Season 1 + Season 2). Your score updates when you generate a Champion card.</p>

      <section class="glass lb-shell">
        <div class="lb-toolbar">
          <div class="lb-search">
            <input id="lbSearch" class="input" type="text" placeholder="Search nickname…" autocomplete="off" />
          </div>
          <!-- sort removed -->
          <button id="lbRefresh" class="btn">Refresh</button>
          <div id="lbMeta" class="lb-meta"></div>
        </div>

        <div class="lb-head">
            <div>#</div>
            <div>User</div>
            <div class="col-s1">Season 1</div>
            <div class="col-s2">Season 2</div>
            <div>Total</div>
          </div>

          <div id="lbList" class="lb-list">
            <div class="lb-empty">Loading…</div>
          </div>
        <div class="lb-note">Tip: if you don’t see your row — open a season → generate your Champion card → come back here and refresh.</div>
      </section>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="../assets/js/supabase-config.js"></script>
    <script src="../assets/js/leaderboard-client.js"></script>
    <script src="./leaderboard.js"></script>
    <script src="../app.js"></script>

    <!-- Profile Modal (same as the main page, so app.js controls it consistently) -->
    <div id="profileModal" class="modal" aria-hidden="true">
      <div class="modalCard">
        <div class="modalCard__head">
          <div>
            <h2 class="modalCard__title">Create your profile</h2>
            <p class="modalCard__sub">This will appear on your result cards</p>
          </div>
          <button id="profileCloseBtn" class="modalClose" aria-label="Close">×</button>
        </div>

        <div class="modalCard__body">
          <div class="profileForm">
            <div class="avatarBox" id="avatarBox">
              <img id="profilePreview" alt="" />
              <button id="avatarPickBtn" class="btn btn--ghost avatarPickBtn" type="button">Upload Avatar</button>
              <input id="profileFile" type="file" accept="image/*" hidden>
            </div>

            <div class="field">
              <input id="profileName" class="input" placeholder="Enter your name" />
              <div class="help">Tip: you can click your profile later to change it</div>

              <div class="btnRow">
                <button id="profileSaveBtn" class="btn">Start</button>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </body>
</html>
